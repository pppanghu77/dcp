# SSH-Setup - SSHå…å¯†ç™»å½•å¿«é€Ÿé…ç½®å·¥å…·

ä¸€ä¸ªç®€å•æ˜“ç”¨çš„Shellè„šæœ¬ï¼Œç”¨äºå¿«é€Ÿä¸ºè¿œç¨‹ä¸»æœºè®¾ç½®SSHå¯†é’¥è®¤è¯ï¼Œå®ç°å…å¯†ç™»å½•ã€‚

## ğŸš€ ç‰¹æ€§

- **ä¸€é”®é…ç½®**: è‡ªåŠ¨ç”ŸæˆSSHå¯†é’¥å¹¶ä¸Šä¼ åˆ°è¿œç¨‹ä¸»æœº
- **å¤šç§å¯†é’¥ç±»å‹**: æ”¯æŒRSAã€Ed25519ã€ECDSA
- **è‡ªåŠ¨æ£€æµ‹**: æ™ºèƒ½æ£€æµ‹ç°æœ‰å¯†é’¥ï¼Œé¿å…é‡å¤ç”Ÿæˆ
- **è¿æ¥æµ‹è¯•**: è‡ªåŠ¨éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ
- **ç«¯å£æ”¯æŒ**: æ”¯æŒéæ ‡å‡†SSHç«¯å£
- **å®‰å…¨å¯é **: ä½¿ç”¨SSHæ ‡å‡†å·¥å…·ï¼Œå®‰å…¨å¯ä¿¡

## ğŸ“¦ ä½¿ç”¨å‰å‡†å¤‡

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…SSHå®¢æˆ·ç«¯å·¥å…·ï¼š

```bash
# Ubuntu/Debian
sudo apt install openssh-client

# CentOS/RHEL
sudo yum install openssh-clients

# Arch Linux
sudo pacman -S openssh
```

## ğŸ¯ åŸºæœ¬ä½¿ç”¨

### 1. å¿«é€Ÿé…ç½®å…å¯†ç™»å½•

```bash
# æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼
./ssh-setup user@192.168.1.100

# æŒ‡å®šSSHç«¯å£
./ssh-setup -p 2222 user@server.com

# ä½¿ç”¨Ed25519å¯†é’¥ï¼ˆæ¨èï¼Œæ›´å®‰å…¨æ›´å¿«ï¼‰
./ssh-setup -t ed25519 user@host.local
```

### 2. é«˜çº§é…ç½®é€‰é¡¹

```bash
# ä½¿ç”¨è‡ªå®šä¹‰å¯†é’¥æ–‡ä»¶
./ssh-setup -k ~/.ssh/mykey user@server.com

# å¼ºåˆ¶é‡æ–°ç”Ÿæˆå¯†é’¥
./ssh-setup -f user@host.com

# ç”Ÿæˆ4096ä½RSAå¯†é’¥
./ssh-setup -t rsa -b 4096 user@server.com
```

### 3. å®ç”¨åŠŸèƒ½

```bash
# åˆ—å‡ºæœ¬åœ°æ‰€æœ‰SSHå¯†é’¥
./ssh-setup --list-keys

# ä»…ç”Ÿæˆå¯†é’¥ï¼Œä¸ä¸Šä¼ 
./ssh-setup --generate-only user@host.com

# æµ‹è¯•ç°æœ‰è¿æ¥
./ssh-setup --test user@host.com
```

## ğŸ“‹ è¯¦ç»†è¯´æ˜

### å‘½ä»¤è¡Œé€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `-h, --help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | - |
| `-k, --key FILE` | æŒ‡å®šå¯†é’¥æ–‡ä»¶è·¯å¾„ | `~/.ssh/id_rsa` |
| `-t, --type TYPE` | å¯†é’¥ç±»å‹ | `rsa` |
| `-b, --bits BITS` | RSAå¯†é’¥é•¿åº¦ | `4096` |
| `-p, --port PORT` | SSHç«¯å£ | `22` |
| `-f, --force` | å¼ºåˆ¶è¦†ç›–ç°æœ‰å¯†é’¥ | `false` |
| `--test` | ä»…æµ‹è¯•è¿æ¥ | `false` |
| `--list-keys` | åˆ—å‡ºæœ¬åœ°å¯†é’¥ | `false` |
| `--generate-only` | ä»…ç”Ÿæˆå¯†é’¥ | `false` |

### æ”¯æŒçš„å¯†é’¥ç±»å‹

1. **RSA** (é»˜è®¤)
   - å…¼å®¹æ€§æœ€å¥½ï¼Œæ”¯æŒæ‰€æœ‰SSHæœåŠ¡å™¨
   - æ¨è4096ä½é•¿åº¦
   - é€‚åˆå¯¹å…¼å®¹æ€§è¦æ±‚é«˜çš„ç¯å¢ƒ

2. **Ed25519** (æ¨è)
   - æ›´å®‰å…¨ã€æ›´å¿«ã€å¯†é’¥æ›´å°
   - ç°ä»£SSHæœåŠ¡å™¨éƒ½æ”¯æŒ
   - æ¨èç”¨äºæ–°ç¯å¢ƒ

3. **ECDSA**
   - æ¤­åœ†æ›²çº¿åŠ å¯†ï¼Œæ€§èƒ½å¥½
   - å¯†é’¥ç›¸å¯¹è¾ƒå°
   - ä¸­ç­‰å…¼å®¹æ€§

## ğŸ¨ å·¥ä½œæµç¨‹

1. **æ£€æŸ¥ä¾èµ–**: éªŒè¯SSHå·¥å…·æ˜¯å¦å®‰è£…
2. **è§£æå‚æ•°**: åˆ†æç›®æ ‡ä¸»æœºå’Œé€‰é¡¹
3. **æ£€æŸ¥å¯†é’¥**: æŸ¥çœ‹æ˜¯å¦å·²æœ‰å¯ç”¨å¯†é’¥
4. **ç”Ÿæˆå¯†é’¥**: æ ¹æ®éœ€è¦ç”Ÿæˆæ–°å¯†é’¥å¯¹
5. **ä¸Šä¼ å…¬é’¥**: ä½¿ç”¨ssh-copy-idä¸Šä¼ å…¬é’¥
6. **æµ‹è¯•è¿æ¥**: éªŒè¯å…å¯†ç™»å½•æ˜¯å¦æˆåŠŸ
7. **é…ç½®å»ºè®®**: æä¾›SSHé…ç½®ä¼˜åŒ–å»ºè®®

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå¼€å‘ç¯å¢ƒå¿«é€Ÿé…ç½®

```bash
# ä¸ºå¼€å‘æœåŠ¡å™¨é…ç½®å…å¯†ç™»å½•
./ssh-setup dev@dev.company.com

# ä¸ºå¤šä¸ªæµ‹è¯•æœåŠ¡å™¨é…ç½®
for server in test1 test2 test3; do
    ./ssh-setup user@$server.company.com
done
```

### åœºæ™¯2ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨Ed25519å¯†é’¥ä¸ºç”Ÿäº§æœåŠ¡å™¨é…ç½®
./ssh-setup -t ed25519 deploy@prod.company.com

# æŒ‡å®šè‡ªå®šä¹‰å¯†é’¥æ–‡ä»¶
./ssh-setup -k ~/.ssh/production_key deploy@prod.server.com
```

### åœºæ™¯3ï¼šå¤šç«¯å£ç¯å¢ƒ

```bash
# éæ ‡å‡†ç«¯å£æœåŠ¡å™¨
./ssh-setup -p 2222 admin@server.com

# å¤æ‚é…ç½®
./ssh-setup -t ed25519 -p 2222 -k ~/.ssh/special_key user@special.server.com
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤º"Permission denied (publickey)"ï¼Ÿ**
```bash
# æ£€æŸ¥SSHå¯†é’¥æ˜¯å¦æ­£ç¡®ä¸Šä¼ 
./ssh-setup --test user@host

# æŸ¥çœ‹æœåŠ¡å™¨SSHé…ç½®
ssh user@host "sudo cat /etc/ssh/sshd_config | grep -E 'PubkeyAuthentication|AuthorizedKeysFile'"
```

**Q: ssh-copy-idå¤±è´¥ï¼Ÿ**
```bash
# æ‰‹åŠ¨ä¸Šä¼ å…¬é’¥
cat ~/.ssh/id_rsa.pub | ssh user@host "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"

# æˆ–è€…ä½¿ç”¨scp
scp ~/.ssh/id_rsa.pub user@host:~/.ssh/authorized_keys
```

**Q: è¿æ¥è¶…æ—¶ï¼Ÿ**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping host

# æ£€æŸ¥SSHæœåŠ¡
nmap -p 22 host

# ä½¿ç”¨è¯¦ç»†æ¨¡å¼è°ƒè¯•
ssh -v user@host
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨SSHè¯¦ç»†è¾“å‡º
ssh -v user@host

# æŸ¥çœ‹å®Œæ•´çš„SSHé…ç½®
ssh -F /dev/null -v user@host
```

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **å®šæœŸè½®æ¢å¯†é’¥**
   ```bash
   # æ¯å¹´æ›´æ¢ä¸€æ¬¡å¯†é’¥
   ./ssh-setup -f -t ed25519 user@host
   ```

2. **ä½¿ç”¨å¼ºå¯†é’¥ç±»å‹**
   ```bash
   # ä¼˜å…ˆä½¿ç”¨Ed25519
   ./ssh-setup -t ed25519 user@host
   ```

3. **é…ç½®SSHå®¢æˆ·ç«¯**
   ```bash
   # åœ¨ ~/.ssh/config ä¸­é…ç½®
   Host production
       HostName prod.server.com
       User deploy
       IdentityFile ~/.ssh/production_key
       IdentitiesOnly yes
   ```

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `ssh-setup` - ä¸»è¦è„šæœ¬æ–‡ä»¶
- `~/.ssh/id_*` - ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶
- `~/.ssh/config` - SSHå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
- `~/.ssh/authorized_keys` - è¿œç¨‹ä¸»æœºä¸Šçš„å…¬é’¥æ–‡ä»¶

## ğŸ¤ ä¸dcpé…åˆä½¿ç”¨

é…ç½®å¥½SSHå…å¯†ç™»å½•åï¼Œdcpçš„ä½“éªŒä¼šæ›´åŠ æµç•…ï¼š

```bash
# å…ˆé…ç½®å…å¯†ç™»å½•
./ssh-setup user@server.com

# ç„¶åæ„‰å¿«åœ°ä½¿ç”¨dcp
./dcp file.txt user@server.com:/tmp/  # æ— éœ€è¾“å…¥å¯†ç 
./dcp --add-alias prod user@server.com
./dcp file.txt @prod:/tmp/             # ä½¿ç”¨åˆ«åï¼Œä¾ç„¶å…å¯†
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒRSAã€Ed25519ã€ECDSAå¯†é’¥ç±»å‹
- è‡ªåŠ¨å¯†é’¥ç”Ÿæˆå’Œä¸Šä¼ åŠŸèƒ½
- è¿æ¥æµ‹è¯•å’Œé…ç½®éªŒè¯
- å¤šç«¯å£æ”¯æŒ

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ï¼Œä¸éœ€è¦å®‰è£…ï¼Œç›´æ¥è¿è¡Œå³å¯ä½¿ç”¨ã€‚ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®SSHé…ç½®æ–‡ä»¶ã€‚
